sudo: false
language: python
python:
- '2.7'
env:
  global:
  - secure: JCvXMwC8FvRyW9VFsVv/v56GDHSjTDhaNUgM3DGQLz0vynoKC2GsH6ifOGFLoa3VwbPXZW+99OXovuzfYg5VGlXkpSirmyOWMeO4UnT6LMTrhd4foYQSPeaZ0ErDZGbXD9uUtKJUsFO3lPLih0Lmnvapo1gXrRIRVAdud3rvSyo=
  - GIT_CONFIG_PARAMETERS="'remote.github.url=https://${TOKEN}@github.com/kontron/robotframework-ipmilibrary.git'"
install: pip install -e .
script: nosetests
after_script:
- PYTHONPATH=src python -m robot.libdoc IpmiLibrary /tmp/IpmiLibrary.html
- git remote set-branches --add origin gh-pages
- git fetch origin
- git checkout gh-pages
- mv /tmp/IpmiLibrary.html .
- git add IpmiLibrary.html
- git config --global user.email "travis@travis-ci.org"
- git config --global user.name "Travis CI"
- git commit -m "autogen libdoc ($(date -R))"
- git push github gh-pages 2>&1 | grep -v http

jobs:
  include:
    - stage: PyPi deploy
      script: true
      python: 2.7

      deploy:
        provider: pypi
        user: hthiery
        password:
          secure: pypi-AgEIcHlwaS5vcmcCJDE4NmFkZDVjLTZhNjQtNDJhZC1iNmVkLTQ1MGY4Y2I4ODQ1MgACS3sicGVybWlzc2lvbnMiOiB7InByb2plY3RzIjogWyJyb2JvdGZyYW1ld29yay1pcG1pbGlicmFyeSJdfSwgInZlcnNpb24iOiAxfQAABiDm508eYP4UJDxUirKlB5hkavWJtVfS1wyaGD8DiPi2LQ
        on:
          tags: true
